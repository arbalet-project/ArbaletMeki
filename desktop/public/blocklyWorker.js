let nbRows;
let nbColumns;

onmessage = function(e){

    if(e.data.message === 'gridLength'){
        nbRows = e.data.nbRows;
        nbColumns = e.data.nbColumns;
    }
    else if (e.data.message === 'blocklyScript'){
        try{
            eval(e.data.script);
        }
        catch(error){
            console.error(error);
        }
        finally{
            close();
        }
    }
}

// Functions used by the Javascript code generated by Blockly
function setPixel(rowX,columnY,color){
    self.postMessage({rowX: rowX, columnY: columnY, color:color});
}

function setRandomPixel(rowX,columnY){
    let randomColor = {
        r: Math.floor(Math.random() * 256),
        g: Math.floor(Math.random() * 256),
        b: Math.floor(Math.random() * 256)
    };
    setPixel(rowX,columnY,randomColor);
}

function switchOffPixel(rowX,columnY){
    setPixel(rowX,columnY,{r:0,g:0,b:0});
}

function switchOffAllPixels(){
    for(let i = 0; i < nbRows; i++){
        for(let j = 0; j < nbColumns; j++){
            switchOffPixel(i,j);
        }
    }
}

function sleep(time,unit) {
    if(unit === 's'){
        time = time * 1000;
    }
    var start = new Date().getTime();
    for (var i = 0; i < 1e7; i++) {
      if ((new Date().getTime() - start) > time){
        break;
      }
    }
  }



